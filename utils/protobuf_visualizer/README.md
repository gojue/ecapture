# eCapture Protobuf Message Visualizer

ä¸€ä¸ªç”¨äºå¯è§†åŒ–å’Œè°ƒè¯• eCapture WebSocket ä¸­ Protobuf æ¶ˆæ¯çš„å·¥å…·ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¨ **å½©è‰²è¾“å‡º** - ä½¿ç”¨ ANSI é¢œè‰²ä»£ç ç¾åŒ–æ˜¾ç¤º
- ğŸ“¦ **äº‹ä»¶å¯è§†åŒ–** - è¯¦ç»†æ˜¾ç¤ºæ•è·çš„ç½‘ç»œäº‹ä»¶
- ğŸ’“ **å¿ƒè·³ç›‘æ§** - å®æ—¶æ˜¾ç¤º WebSocket å¿ƒè·³åŒ…
- ğŸ“‹ **æ—¥å¿—è·Ÿè¸ª** - æ•è·å¹¶æ˜¾ç¤ºè¿›ç¨‹æ—¥å¿—
- ğŸ” **å¤šç§æ ¼å¼** - æ”¯æŒæ–‡æœ¬å’Œåå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤º Payload
- ğŸ“Š **ç»Ÿè®¡ä¿¡æ¯** - é€€å‡ºæ—¶æ˜¾ç¤ºæ¥æ”¶æ¶ˆæ¯çš„ç»Ÿè®¡

## ç¼–è¯‘

```bash
cd /home/hugo/zenyanle_ecap/ecapture/utils/protobuf_visualizer
go build -o pb_debugger pb_debugger.go
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# è¿æ¥åˆ°é»˜è®¤çš„ WebSocket æœåŠ¡å™¨ (ws://127.0.0.1:28257)
./pb_debugger

# æŒ‡å®šè‡ªå®šä¹‰ WebSocket URL
./pb_debugger -url ws://192.168.1.100:28257
```

### å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `-url` | `ws://127.0.0.1:28257` | WebSocket æœåŠ¡å™¨ URL |
| `-hex` | `false` | ä»¥åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤º Payload |
| `-max-payload` | `1024` | æ˜¾ç¤ºçš„æœ€å¤§ Payload å­—èŠ‚æ•° |
| `-no-color` | `false` | ç¦ç”¨å½©è‰²è¾“å‡º |
| `-compact` | `false` | ç´§å‡‘è¾“å‡ºæ¨¡å¼ï¼ˆå•è¡Œæ˜¾ç¤ºï¼‰ |

### ä½¿ç”¨ç¤ºä¾‹

#### 1. æ ‡å‡†è¯¦ç»†æ¨¡å¼

```bash
./pb_debugger
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                              â•‘
â•‘                    eCapture Protobuf Message Visualizer                      â•‘
â•‘                                                                              â•‘
â•‘                         WebSocket Debugging Tool                             â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Connected to: ws://127.0.0.1:28257
Listening for messages... (Press Ctrl+C to quit)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€ ğŸ“¦ EVENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ â–¶ Metadata:
â”‚   Sequence: #1
â”‚   Timestamp: 2025-10-10 14:30:45
â”‚   UUID: 12345_67890_curl
â”‚ â–¶ Process:
â”‚   PID: 12345
â”‚   Process Name: curl
â”‚ â–¶ Network:
â”‚   Connection: 192.168.1.100:54321 â†’ 93.184.216.34:443
â”‚ â–¶ Event Details:
â”‚   Type: 0 (Send/Write)
â”‚   Length: 517 bytes
â”‚ â–¶ Payload:
â”‚   GET /index.html HTTP/1.1
â”‚   Host: example.com
â”‚   ...
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

#### 2. ç´§å‡‘æ¨¡å¼

```bash
./pb_debugger -compact
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
[14:30:45] ğŸ’“ HEARTBEAT #1 heartbeat:1
[14:30:46] ğŸ“‹ LOG Starting capture...
[14:30:47] ğŸ“¦ EVENT #1 PID:12345 192.168.1.100:54321 â†’ 93.184.216.34:443 [517 bytes]
[14:30:48] ğŸ“¦ EVENT #2 PID:12345 192.168.1.100:54321 â†’ 93.184.216.34:443 [1024 bytes]
```

#### 3. åå…­è¿›åˆ¶æ¨¡å¼

```bash
./pb_debugger -hex
```

æ˜¾ç¤º Payload çš„å®Œæ•´åå…­è¿›åˆ¶è½¬å‚¨ã€‚

#### 4. æ— é¢œè‰²æ¨¡å¼ï¼ˆç”¨äºæ—¥å¿—æ–‡ä»¶ï¼‰

```bash
./pb_debugger -no-color > capture.log
```

#### 5. é™åˆ¶ Payload å¤§å°

```bash
./pb_debugger -max-payload 256
```

åªæ˜¾ç¤ºå‰ 256 å­—èŠ‚çš„ Payloadã€‚

## æ¶ˆæ¯ç±»å‹

å·¥å…·æ”¯æŒä¸‰ç§ Protobuf æ¶ˆæ¯ç±»å‹ï¼š

### 1. å¿ƒè·³åŒ… (Heartbeat)
- **LogType**: `LOG_TYPE_HEARTBEAT` (0)
- **å›¾æ ‡**: ğŸ’“
- **é¢œè‰²**: ç´«è‰²
- **å†…å®¹**: åŒ…å«æ—¶é—´æˆ³ã€è®¡æ•°å’Œæ¶ˆæ¯

### 2. è¿›ç¨‹æ—¥å¿— (Process Log)
- **LogType**: `LOG_TYPE_PROCESS_LOG` (1)
- **å›¾æ ‡**: ğŸ“‹
- **é¢œè‰²**: ç»¿è‰²
- **å†…å®¹**: eCapture è¿è¡Œæ—¶çš„æ–‡æœ¬æ—¥å¿—

### 3. äº‹ä»¶ (Event)
- **LogType**: `LOG_TYPE_EVENT` (2)
- **å›¾æ ‡**: ğŸ“¦
- **é¢œè‰²**: è“è‰²
- **å†…å®¹**: æ•è·çš„ç½‘ç»œäº‹ä»¶ï¼ŒåŒ…å«ï¼š
  - æ—¶é—´æˆ³å’Œ UUID
  - è¿›ç¨‹ä¿¡æ¯ï¼ˆPIDã€è¿›ç¨‹åï¼‰
  - ç½‘ç»œè¿æ¥ä¿¡æ¯ï¼ˆæº/ç›®æ ‡ IP å’Œç«¯å£ï¼‰
  - äº‹ä»¶ç±»å‹å’Œæ•°æ®é•¿åº¦
  - Payload æ•°æ®

## Protobuf ç»“æ„

### LogEntry
```protobuf
message LogEntry {
  LogType log_type = 1;
  oneof payload {
    Event event_payload = 2;
    Heartbeat heartbeat_payload = 3;
    string run_log = 4;
  }
}
```

### Event
```protobuf
message Event {
  int64 timestamp = 1;
  string uuid = 2;
  string src_ip = 3;
  uint32 src_port = 4;
  string dst_ip = 5;
  uint32 dst_port = 6;
  int64 pid = 7;
  string pname = 8;
  uint32 type = 9;
  uint32 length = 10;
  bytes payload = 11;
}
```

### Heartbeat
```protobuf
message Heartbeat {
  int64 timestamp = 1;
  int64 count = 2;
  string message = 3;
}
```

## è¾“å‡ºç¤ºä¾‹

### å®Œæ•´äº‹ä»¶æ˜¾ç¤º

```
â”Œâ”€â”€â”€ ğŸ“¦ EVENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ â–¶ Metadata:
â”‚   Sequence: #42
â”‚   Timestamp: 2025-10-10 14:30:45
â”‚   UUID: 12345_67890_curl
â”‚ â–¶ Process:
â”‚   PID: 12345
â”‚   Process Name: curl
â”‚ â–¶ Network:
â”‚   Connection: 192.168.1.100:54321 â†’ 93.184.216.34:443
â”‚ â–¶ Event Details:
â”‚   Type: 0 (Send/Write)
â”‚   Length: 517 bytes
â”‚ â–¶ Payload:
â”‚   GET /index.html HTTP/1.1
â”‚   Host: example.com
â”‚   User-Agent: curl/7.68.0
â”‚   Accept: */*
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

### ç»Ÿè®¡ä¿¡æ¯

```
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Statistics:
  Events received: 156
  Heartbeats received: 12
  Logs received: 8
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

## é¢œè‰²è¯´æ˜

- ğŸ”µ **è“è‰²** - äº‹ä»¶ (Event)
- ğŸŸ£ **ç´«è‰²** - å¿ƒè·³ (Heartbeat)
- ğŸŸ¢ **ç»¿è‰²** - æ—¥å¿— (Log)
- ğŸŸ¡ **é»„è‰²** - å­—æ®µåç§°
- âšª **ç™½è‰²** - å­—æ®µå€¼
- âš« **ç°è‰²** - è¾…åŠ©ä¿¡æ¯

## æ•…éšœæ’é™¤

### æ— æ³•è¿æ¥åˆ° WebSocket æœåŠ¡å™¨

ç¡®ä¿ eCapture æ­£åœ¨è¿è¡Œå¹¶å¯ç”¨äº† WebSocket æœåŠ¡å™¨ï¼š

```bash
ecapture tls -w ws --ws-addr 127.0.0.1:28257
```

### æ¶ˆæ¯è§£æå¤±è´¥

ç¡®ä¿ eCapture å’Œå¯è§†åŒ–å·¥å…·ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„ Protobuf å®šä¹‰ã€‚

### æ€§èƒ½é—®é¢˜

å¦‚æœäº‹ä»¶å¤ªå¤šå¯¼è‡´è¾“å‡ºè¿‡å¿«ï¼š
- ä½¿ç”¨ `-compact` æ¨¡å¼
- ä½¿ç”¨ `-max-payload` é™åˆ¶ Payload å¤§å°
- å°†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ï¼š`./pb_debugger > capture.log`

## ä¾èµ–é¡¹

- `golang.org/x/net/websocket` - WebSocket å®¢æˆ·ç«¯
- `google.golang.org/protobuf` - Protobuf åºåˆ—åŒ–/ååºåˆ—åŒ–
- `github.com/gojue/ecapture/protobuf/gen/v1` - eCapture Protobuf å®šä¹‰

## è®¸å¯è¯

Apache License 2.0

## ä½œè€…

eCapture Project Contributors
